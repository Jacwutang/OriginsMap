<!DOCTYPE html>
<html lang="en">
<head>

  <title>Mapping with D3</title>
	<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="US.json"></script>
  <!-- <script src="test.csv"></script> -->


  <style>
  svg{
    /*background: red;*/
    /*text-align: center;
    margin-left: auto;
    margin-right: auto;*/
    margin-top: 0;

  }

  .county{
    fill: #e3e3e3;
    stroke: #333;
    stroke-width: 0.5;
    cursor: pointer;

  }

  body{
    text-align: center;
    margin-left: auto;
    margin-right: auto;
  }

  .city-circle{
    color:green;
    fill: green;
  }






  .selected{
    fill: yellow;
  }

  .selectedZoom{
    fill:yellow;
  }

  </style>

</head>
<body>
	<!-- Page elements and content go here. -->
  <h1> BirthPlace of 23,000+ NFL Players from the 1960s to 2014 </h1>
  <h3>
  <script>
		// Our D3 code will go here.

    // var margin = {top: 0, left: 0, right: 0, bottom: 0},
    // height = 400 - margin.top - margin.bottom,
    // width = 800 - margin.left - margin.right;


    var width = 850;
    var height = 750;

    var tooltip = d3.select("body")
	   .append("div")
	    .style("position", "absolute")
	     .style("z-index", "10")
	      .style("visibility", "hidden")
	       .text("a simple tooltip");

    var svg = d3.select("body").append("svg")
      .attr("width", width )
      .attr("height", height)
      .append("g") // add a 'g' children tag


    var projection = d3.geoAlbersUsa()
    .translate([width/2, height/2])
    .scale(1000);


    var path = d3.geoPath()
    .projection(projection);

    var zoomSettings = {
      zoomLevel: 3,
      duration: 1000,
      ease: d3.easeCubicOut

    }



    // g.transition()
    //   .duration(zoomSettings.duration)
    //   .ease(zoomSettings.ease)
    //   .attr('transform', 'translate(' + width/2 + ',' + height/2 + ') scale(' + zoomLevel + ')translate(' + -x + ',' + -y + ')');


    d3.json("US.json", function(error, US) {
      if (error) return console.error(error);
        d3.csv("players_2013_geocodio.csv",function(error, players ){
          var x;
          var y;
          var zoomLevel;
          var centered;
          var oldNode;

          var counties = topojson.feature(US,US.objects.counties).features; //returns counties array
          // console.log(counties);
          // console.log(players);

          // svg.selectAll(".city-circle")
          // .data(players)
          // .enter()
          // .append("circle")
          // .attr("r",2)
          // .attr("cx", 10)
          // .attr("cy",10)

          // svg.select(".city-circle")
          // .data(players)
          // .enter()
          // .append("circle")
          // .attr("r",2)
          // .attr("cx", 10)
          // .attr("cy",10)

          svg.selectAll(".county")
          .data(counties)
          .enter() // for each
          .append("path") // each item gets "path"
          .attr("class", "county")
          //Make a projection first
          .attr("d",path)
          .on("mouseover", function(d){
            d3.select(this).classed("selected",true)
          })
          .on("mouseout", function(d){
            d3.select(this).classed("selected",false)
          })
          .on("click", function(d){
              // alert("Return to original view? Click on a different county");

              if(d && centered !== d){

                var centroid = path.centroid(d);

                x = centroid[0];
                y = centroid[1];
                zoomLevel = zoomSettings.zoomLevel;
                centered = d;
                // currentNode = d;
                if(oldNode === null){
                  oldNode = this;
                }

                d3.select(this).classed("selectedZoom",true);
                alert("Click Yellow Box to zoom out")

                if(this !== oldNode){
                  d3.select(oldNode).classed("selectedZoom",false);
                  oldNode = this;
                }
              }

              else{

                x = width/2;
                y = width/2;
                zoomLevel = 1;
                centered = null;
                  d3.select(this).classed("selectedZoom",false);

              }

              svg.transition()
                .duration(zoomSettings.duration)
                .ease(zoomSettings.ease)
                .attr('transform', 'translate(' + width/2 + ',' + height/2 + ') scale(' + zoomLevel + ')translate(' + -x + ',' + -y + ')');
               //onClick
          })
          svg.selectAll(".city-circle")
          .data(players)
          .enter()
          .append("circle")
          .attr("class","city-circle")
          .attr("r",2)
          .attr("cx", function(player){

            // console.log(player.name, player.Longitude,player.Latitude);
            //  console.log(player.Longitude);
            //  console.log(player.Latitude);
              var coords = projection([player.Longitude,player.Latitude]);
              //-98.614928
              //27.899181
              if(coords === undefined || coords === null){
                return 0;
              } else{
                return coords[0];
              }

          })
          .attr("cy", function(player){

            // console.log("HERE");
            // console.log(player.name, "HERE");
            // console.log(player.Longitude);
            // console.log(player.Latitude);
            var coords = projection([player.Longitude,player.Latitude]);

            if(coords === undefined || coords === null){
              return 0;
            } else{
              return coords[1];
            }

            // return coords[1];
          })
          .on("mouseover", function(player){
            return tooltip.style("visibility", "visible").style("background", "white").text(player.name + " " + player.birth_date + " " + player.college)
          })
	         .on("mousemove", function(player){
             return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
           })
	          .on("mouseout", function(player){
              return tooltip.style("visibility", "hidden");
            })
          //.text(function(player) { return player.name; })






        })
    })

    // svg.selectAll(".city-circle")
    // .data(players)
    // .enter()
    // .append("circle")
    // .attr("r",2)
    // .attr("cx", function(player){
    //
    //   console.log(player.name);
    //   console.log(player.Longitude);
    //   console.log(player.Latitude);
    //     var coords = projection([-98.614928,27.899181]);
    //     //-98.614928
    //     //27.899181
    //     return coords[0];
    // })
    // .attr("cy", function(player){
    //   console.log("HERE");
    //   console.log(player.name);
    //   console.log(player.Longitude);
    //   console.log(player.Latitude);
    //   var coords = projection([-98.614928,27.899181]);
    //   return coords[1];
    // })

    </script>
</body>
</html>


<!-- .attr("cx", function(cities.lat){
  var coords = projection([cities.lat, cities.long]);
  console.log(coords);
}) -->
