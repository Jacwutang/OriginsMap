<!DOCTYPE html>
<html lang="en">
<head>

  <title>Origins Map</title>
	<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="US.json"></script>
  <!-- <script src="test.csv"></script> -->


  <style>
  svg{
    /*background: red;*/
    /*text-align: center;
    margin-left: auto;
    margin-right: auto;*/
    margin-top: 0;
    background-color: gray;
    width: 100%;


  }

  .county{
    fill: #e3e3e3;
    stroke: #333;
    stroke-width: 0.5;
    cursor: pointer;

  }

  body{
    text-align: center;
    margin-left: auto;
    margin-right: auto;
  }

  h2{
    font-weight: lighter;

  }

  h3{
    font-weight: lighter;

  }

  .intro{

    width: 100%;
    height: 350px;
    margin: 0 auto;
    background-color: white;
  }

  .city-circle{
    color:green;
    fill: green;
  }

  .instructions{
    text-align: center;

  }






  .selected{
    fill: yellow;
  }

  .selectedZoom{
    fill:yellow;
  }

  </style>

</head>
<body>
	<!-- Page elements and content go here. -->
  <div class="intro">
    <h1> Explore Hotspots of Football Talent </h1>
    <h2> Using NFL dataset of over 23,000 former and active football players from the 1960s until now.</h2>
    <h3> Where is the next generation of talent going to come from? </h3>
    <div class = "instructions">
      <h4> 1. Click on any box to zoom in </h4>
      <h4> 2. Click yellow box to zoom out. </h4>
      <h4> 3. player_name - birth_date - college </h4>
    </div>
  </div>

  <script>

    STATES = {
      "01": "Alabama",
      "02": "Alaska",
      "04": "Arizona",
      "05": "Arkansas",
      "06": "California",
      "08": "Colorado",
      "09": "Connecticut",
      "10": "Delaware",
      "11": "District of Columbia",
      "12": "Florida",
      "13": "Geogia",
      "15": "Hawaii",
      "16": "Idaho",
      "17": "Illinois",
      "18": "Indiana",
      "19": "Iowa",
      "20": "Kansas",
      "21": "Kentucky",
      "22": "Louisiana",
      "23": "Maine",
      "24": "Maryland",
      "25": "Massachusetts",
      "26": "Michigan",
      "27": "Minnesota",
      "28": "Mississippi",
      "29": "Missouri",
      "30": "Montana",
      "31": "Nebraska",
      "32": "Nevada",
      "33": "New Hampshire",
      "34": "New Jersey",
      "35": "New Mexico",
      "36": "New York",
      "37": "North Carolina",
      "38": "North Dakota",
      "39": "Ohio",
      "40": "Oklahoma",
      "41": "Oregon",
      "42": "Pennsylvania",
      "44": "Rhode Island",
      "45": "South Carolina",
      "46": "South Dakota",
      "47": "Tennessee",
      "48": "Texas",
      "49": "Utah",
      "50": "Vermont",
      "51": "Virginia",
      "53": "Washington",
      "54": "West Virginia",
      "55": "Wisconsin",
      "56": "Wyoming"
      }

    var width = 1500;
    var height = 1000;

    var tooltip = d3.select("body")
	   .append("div")
	    .style("position", "absolute")
	     .style("z-index", "10")
	      .style("visibility", "hidden")
	       .text("");

    var svg = d3.select("body").append("svg")
      .attr("width", width )
      .attr("height", height)
      .append("g") // add a 'g' children tag


    var projection = d3.geoAlbersUsa()
    .translate([width/2, height/2])
    .scale(1000);


    var path = d3.geoPath()
    .projection(projection);

    var zoomSettings = {
      zoomLevel: 25,
      duration: 500,
      ease: d3.easeCubicOut

    }



    d3.json("US.json", function(error, US) {
      if (error) return console.error(error);
        d3.csv("players_2013_geocodio.csv",function(error, players ){
          var x;
          var y;
          var zoomLevel;
          var centered;
          var oldNode;

          var counties = topojson.feature(US,US.objects.counties).features; //returns counties array
          // console.log(counties);
          // console.log(players);

          // svg.selectAll(".city-circle")
          // .data(players)
          // .enter()
          // .append("circle")
          // .attr("r",2)
          // .attr("cx", 10)
          // .attr("cy",10)

          // svg.select(".city-circle")
          // .data(players)
          // .enter()
          // .append("circle")
          // .attr("r",2)
          // .attr("cx", 10)
          // .attr("cy",10)

          svg.selectAll(".county")
          .data(counties)
          .enter() // for each
          .append("path") // each item gets "path"
          .attr("class", "county")
          //Make a projection first
          .attr("d",path)
          .on("mouseover", function(d){
            d3.select(this).classed("selected",true)
            // console.log(d.properties.NAME);
            tooltip.style("visibility", "visible").style("background", "white").text("State: " + STATES[d.properties.STATEFP] + " " +  "County: "+ d.properties.NAME)

          })
          .on("mousemove", function(d){
            return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
          })
          .on("mouseout", function(d){
            d3.select(this).classed("selected",false)
          })
          .on("click", function(d){
              // alert("Return to original view? Click on a different county");

              if(d && centered !== d){

                var centroid = path.centroid(d);

                x = centroid[0];
                y = centroid[1];
                zoomLevel = zoomSettings.zoomLevel;
                centered = d;
                // currentNode = d;
                if(oldNode === null){
                  oldNode = this;
                }

                d3.select(this).classed("selectedZoom",true);
                alert("Click Yellow Box to zoom out")

                if(this !== oldNode){
                  d3.select(oldNode).classed("selectedZoom",false);
                  oldNode = this;
                }
              }

              else{

                x = width/2;
                y = width/2;
                zoomLevel = 1;
                centered = null;
                  d3.select(this).classed("selectedZoom",false);

              }

              svg.transition()
                .duration(zoomSettings.duration)
                .ease(zoomSettings.ease)
                .attr('transform', 'translate(' + width/2 + ',' + height/2 + ') scale(' + zoomLevel + ')translate(' + -x + ',' + -y + ')');
               //onClick
          })
          svg.selectAll(".city-circle")
          .data(players)
          .enter()
          .append("circle")
          .attr("class","city-circle")
          .attr("r",.9)
          .attr("cx", function(player){

            // console.log(player.name, player.Longitude,player.Latitude);
            //  console.log(player.Longitude);
            //  console.log(player.Latitude);
              var coords = projection([player.Longitude,player.Latitude]);
              //-98.614928
              //27.899181
              if(coords === undefined || coords === null){
                return 0;
              } else{
                return coords[0];
              }

          })
          .attr("cy", function(player){

            // console.log("HERE");
            // console.log(player.name, "HERE");
            // console.log(player.Longitude);
            // console.log(player.Latitude);
            var coords = projection([player.Longitude,player.Latitude]);

            if(coords === undefined || coords === null){
              return 0;
            } else{
              return coords[1];
            }

            // return coords[1];
          })
          .on("mouseover", function(player){
            return tooltip.style("visibility", "visible").style("background", "white").text(player.name + " " + player.birth_date + " " + " " + " " + player.college)
          })
	         .on("mousemove", function(player){
             return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
           })
	          .on("mouseout", function(player){
              return tooltip.style("visibility", "hidden");
            })
          //.text(function(player) { return player.name; })






        })
    })

    // svg.selectAll(".city-circle")
    // .data(players)
    // .enter()
    // .append("circle")
    // .attr("r",2)
    // .attr("cx", function(player){
    //
    //   console.log(player.name);
    //   console.log(player.Longitude);
    //   console.log(player.Latitude);
    //     var coords = projection([-98.614928,27.899181]);
    //     //-98.614928
    //     //27.899181
    //     return coords[0];
    // })
    // .attr("cy", function(player){
    //   console.log("HERE");
    //   console.log(player.name);
    //   console.log(player.Longitude);
    //   console.log(player.Latitude);
    //   var coords = projection([-98.614928,27.899181]);
    //   return coords[1];
    // })

    </script>


</body>
</html>


<!-- .attr("cx", function(cities.lat){
  var coords = projection([cities.lat, cities.long]);
  console.log(coords);
}) -->
