<!DOCTYPE html>
<html lang="en">
<head>

  <title>Mapping with D3</title>
	<script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="US.json"></script>
  <!-- <script src="test.csv"></script> -->


  <style>
  svg{
    /*background: red;*/
    /*text-align: center;
    margin-left: auto;
    margin-right: auto;*/

  }

  .county{
    fill: #e3e3e3;
    stroke: #333;
    stroke-width: 0.5;
    cursor: pointer;

  }

  body{
    text-align: center;
    margin-left: auto;
    margin-right: auto;
  }




  .selected{
    fill: yellow;
  }

  .selectedZoom{
    fill:yellow;
  }

  </style>

</head>
<body>
	<!-- Page elements and content go here. -->
  <h1> Hello Worldsss </h1>

  <script>
		// Our D3 code will go here.

    // var margin = {top: 0, left: 0, right: 0, bottom: 0},
    // height = 400 - margin.top - margin.bottom,
    // width = 800 - margin.left - margin.right;


    var width = 850;
    var height = 900;

    var svg = d3.select("body").append("svg")
      .attr("width", width )
      .attr("height", height)
      .append("g") // add a 'g' children tag


    var projection = d3.geoAlbersUsa()
    .translate([width/2, height/2])
    .scale(1000);


    var path = d3.geoPath()
    .projection(projection);

    var zoomSettings = {
      zoomLevel: 3,
      duration: 1000,
      ease: d3.easeCubicOut

    }



    // g.transition()
    //   .duration(zoomSettings.duration)
    //   .ease(zoomSettings.ease)
    //   .attr('transform', 'translate(' + width/2 + ',' + height/2 + ') scale(' + zoomLevel + ')translate(' + -x + ',' + -y + ')');


    d3.json("US.json", function(error, US) {
      if (error) return console.error(error);
        d3.csv("test.csv",function(error, cities ){
          var x;
          var y;
          var zoomLevel;
          var centered;
          var oldNode;

          var counties = topojson.feature(US,US.objects.counties).features; //returns counties array
          console.log(counties);
          console.log(cities);

          // svg.selectAll(".city-circle")
          // .data(cities)
          // .enter()
          // .append("circle")
          // .attr("r",2)
          // .attr("cx", 10)
          // .attr("cy",10)

          // svg.select(".city-circle")
          // .data(cities)
          // .enter()
          // .append("circle")
          // .attr("r",2)
          // .attr("cx", 10)
          // .attr("cy",10)

          svg.selectAll(".county")
          .data(counties)
          .enter() // for each
          .append("path") // each item gets "path"
          .attr("class", "county")
          //Make a projection first
          .attr("d",path)
          .on("mouseover", function(d){
            d3.select(this).classed("selected",true)
          })
          .on("mouseout", function(d){
            d3.select(this).classed("selected",false)
          })
          .on("click", function(d){
              // alert("Return to original view? Click on a different county");

              if(d && centered !== d){

                var centroid = path.centroid(d);

                x = centroid[0];
                y = centroid[1];
                zoomLevel = zoomSettings.zoomLevel;
                centered = d;
                // currentNode = d;
                if(oldNode === null){
                  oldNode = this;
                }

                d3.select(this).classed("selectedZoom",true);
                alert("Click Yellow Box to zoom out")

                if(this !== oldNode){
                  d3.select(oldNode).classed("selectedZoom",false);
                  oldNode = this;
                }
              }

              else{

                x = width/2;
                y = width/2;
                zoomLevel = 1;
                centered = null;
                  d3.select(this).classed("selectedZoom",false);

              }

              svg.transition()
                .duration(zoomSettings.duration)
                .ease(zoomSettings.ease)
                .attr('transform', 'translate(' + width/2 + ',' + height/2 + ') scale(' + zoomLevel + ')translate(' + -x + ',' + -y + ')');
               //onClick
          })

          svg.selectAll(".city-circle")
          .data(cities)
          .enter()
          .append("circle")
          .attr("r",2)
          .attr("cx", function(){
              var coords = projection([-110,40]);
              debugger;
              return coords[0];
          })
          .attr("cy", function(){
            var coords = projection([40.21604,-76.924996]);
            return coords[1];
          })




        })
    })

    </script>
</body>
</html>


<!-- .attr("cx", function(cities.lat){
  var coords = projection([cities.lat, cities.long]);
  console.log(coords);
}) -->
